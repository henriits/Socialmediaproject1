{% extends 'base.html' %}

{% load static %}

{% block content %}
<div class="container post-feed">

  <div class="row justify-content-center">
    <div class="col-md-10">
      {% for post in posts %}
      {% if forloop.first %}

    <!-- First field to add new post -->
    <div class="write-post-container">
      <div class="user-profile">
        <img src="{{ post.user.profile.profile_pic.url }}">
        <div>
          <p>{{ user.username }}</p>
          <small>Public <i class="fa-solid fa-caret-down"></i></small>
        </div>
      </div>


      <div class="post-input-container">
        <form method="post" action="{% url 'posts:create_post' %}">
          {% csrf_token %}
          <input type="text" name="title" placeholder="Post Title">
          <textarea name="content" rows="3" placeholder="What's on your mind, {{ user.username }}?"></textarea>
          <div class="add-post-links">
            <label for="image-upload"><i class="fa-solid fa-image" style="color: #defa00;"></i>Add image</label>
            <input type="file" id="image-upload" name="image" accept="image/*">
            <button type="submit"><i class="fa-solid fa-circle-arrow-up" style="color: #defa00;"></i>Upload the post</button>
          </div>
        </form>
      </div>

    </div>
    {% endif %}

    <!-- Display posts -->
    <div class="post-container">
      <div class="user-profile">
        <img src="{{ post.user.profile.profile_pic.url }}">
        <div>
          <p>{{ post.author.username }}</p>
          <span class="text-muted">Created Date:</span> <span class="text-dark">{{ post.created_date }}</span>
          <br>
          <br>
        </div>
      </div>

      <h5 class="post-title">{{ post.title }}</h5>
      {% if post.image %}
      <img src="{{ post.image.url }}" class="post-img" alt="{{ post.title }}">
      {% else %}
      <img src="{% static 'img/defaultpost_img.jpg' %}" class="post-img" alt="Default Image">
      {% endif %}
      <p class="post-text">{{ post.text }}</p>

      <div class="post-row">
        <div class="activity-icons">
          <div>
            <!-- Like section -->
            <form method="post" action="{% url 'posts:like_post' post.pk %}">
              {% csrf_token %}
              <button class="like-btn" type="submit" name="post_id" value="{{post.id}}">
                <i class="fa-solid fa-thumbs-up {% if request.user in post.likes.all %}active{% endif %}" style="color: #defa00;"></i>
              {{ post.total_likes }}
              </button>
            </form>
          </div>

          <div><i class="fa-solid fa-comments" style="color: #defa00;"></i> comments </div>
          <div><i class="fa-sharp fa-solid fa-share" style="color: #defa00;"></i> followers </div>
        </div>
      </div>

      <br>


      <!-- Display comments -->
      <div class="comments">
        <h6>Comments:</h6>
        <ul>
          {% for comment in comments %}
            <li>{{ comment.comment }} - {{ comment.user_id.username }} ({{ comment.created_at }})</li>
          {% empty %}
            <li>No comments yet.</li>
          {% endfor %}
        </ul>
      </div>

      <!-- Comment form -->
      <form method="post" action="{% url 'posts:create_comment' post.id %}">
        {% csrf_token %}
        <div class="comment-form">
        {{ comment_form.as_p }}
        </div>
        <button class="add-comment-btn" type="submit">Add Comment</button>
      </form>


    </div>


    {% endfor %}
    </div>
  </div>
</div>
{% endblock %}